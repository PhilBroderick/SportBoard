@model SportBoard.Web.Models.ViewModels.PostCommentsViewModel
@{
    ViewBag.Title = "Details";
}

<h2>23<i class="fas fa-thumbs-up" id="mainUpvote"></i>12<i class="fas fa-thumbs-down" id="mainDownvote"></i></h2>
<div class="row">
    <div class="col-md-12">
        <div class="thumbnail">
            <img src="@Url.Content("~/Content/images/" + Model.Post.Image.FileName + ".jpg")" alt="...">
            <div class="caption">
                <h3>@Model.Post.Description</h3>
                <p><a href="#" class="btn btn-primary" role="button"><i class="fas fa-thumbs-up fa-lg"></i></a> <a href="#" class="btn btn-default" role="button"><i class="fas fa-thumbs-down fa-lg"></i></a></p>
            </div>
        </div>
    </div>
</div>

<form id="form">
    <div class="row">
        <div class="input-group">
            <div class="col-md-12">
                <textarea rows="5" , cols="100" id="commentText" placeholder="Enter comment here . . ."></textarea>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-10">
                <input type="submit" value="Add Comment" class="btn btn-success" id="submit" />
            </div>
        </div>
    </div>
</form>
<hr />
@foreach(var comment in Model.Comments)
{
    <div class="panel panel-default panel-primary">
        <div class="panel-body">
            <p>@comment.CommentText</p>
        </div>
        <div class="panel-footer">@comment.AspNetUsers.Email
            <span class="updownVoteBtns">
                <a href="@Url.Action("Upvote", "Comment", new { commentId = comment.CommentId })" title="Upvote" id="upVoteLink"><i class="far fa-arrow-alt-circle-up fa-2x"></i></a><a href="@Url.Action("Downvote", "Comment", new { commentId = comment.CommentId  })" title="Downvote"><i class="far fa-arrow-alt-circle-down fa-2x"></i></a>
            </span>
        </div>
    </div>
}

@section Styles{
    <style>
        .updownVoteBtns{
            float:right;
        }

        #upVoteLink{
            margin-right:3px;
        }

        #mainUpvote, #mainDownvote{
            margin-left:5px;
            margin-right:5px;
        }
    </style>
        
}

@section scripts{
    <script>

        $(document).ready(function () {
            $("#form").on("submit", function (e) {
                e.preventDefault()
                var formData = new FormData();
                var commentText = $("#commentText").val();
                var postId = @Model.Post.PostId;
                formData.append("commentText", commentText);
                formData.append("postId", postId);
                
                $.ajax({
                    type: "POST",
                    url: '/Comment/Create',
                    data: formData,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        window.location.href = response.Url;
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert("Unknown error occured. Please try again!");
                    }
                });
            });
        });
    </script>
}